<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PureChart Demo - Full Showcase</title>
    <link rel="stylesheet" href="PureChart.css">
</head>
<body>
    <h1>PureChart Demonstration - Full Showcase</h1>

    <div class="chart-container">
        <h2>Chart 1: Advanced Mixed Chart (Dark Theme)</h2>
        <p>Demonstrates multiple bar and line datasets, dashed lines, legend interaction, and a basic annotation. Explicitly set to <code>theme: 'dark'</code>.</p>
        <canvas id="advancedMixedChartCanvas" width="700" height="400"></canvas>
    </div>

    <div class="chart-container">
        <h2>Chart 2: Multiple SMAs and Annotations (Light Theme)</h2>
        <p>Demonstrates a primary line series with two Simple Moving Averages (SMAs) and multiple horizontal annotations with varied styling. Explicitly set to <code>theme: 'light'</code>.</p>
        <canvas id="multipleSmaAnnotationCanvas" width="700" height="400"></canvas>
    </div>
    
    <div class="chart-container">
        <h2>Chart 3: Loaded from JSON (Dark Theme via Override)</h2>
        <p>This chart is configured from <code>sample-data.json</code> and then <code>theme: 'dark'</code> is applied via overrideOptions.</p>
        <canvas id="jsonLoadedChartCanvas" width="700" height="400"></canvas>
    </div>

    <div class="chart-container">
        <h2>Chart 4: Loaded via PureChart.fromJSON()</h2>
        <p>This chart demonstrates loading data using the <code>PureChart.fromJSON()</code> static method, including the conceptual CSRF token parameter.</p>
        <canvas id="fromJsonDemoCanvas" width="700" height="350"></canvas>
    </div>

    <div class="chart-container">
        <h2>Chart 5: Multi-Line Chart (Few-Items Legend Control)</h2>
        <p>Demonstrates a chart with two distinct line series. Used as a control for legend spacing.</p>
        <canvas id="multiLineChartCanvas" width="700" height="400"></canvas>
    </div>

    <div class="chart-container">
        <h2>Chart 6: Vertical Bar Chart (topCornerRadius: 8 Test)</h2>
        <p>Tests rounded top corners for positive bars. Negative and zero bars should remain sharp.</p>
        <canvas id="verticalBarChartCanvas" width="700" height="400"></canvas>
    </div>

    <div class="chart-container">
        <h2>Chart 6b: Vertical Bar Chart (topCornerRadius: 0 Control)</h2>
        <p>Control test for rounded corners. All corners should be sharp.</p>
        <canvas id="verticalBarChartControlCanvas" width="700" height="400"></canvas>
    </div>

    <div class="chart-container">
        <h2>Chart 7: Horizontal Bar Chart (Implemented as Vertical)</h2>
        <p>Demonstrates a bar chart. (Note: True horizontal bar charts are not yet supported; this is a vertical bar chart).</p>
        <canvas id="horizontalBarChartCanvas" width="700" height="400"></canvas>
    </div>

    <div class="chart-container">
        <h2>Chart 8: Chart with Calculated Line (SMA)</h2>
        <p>Displays a primary data series and a calculated Simple Moving Average (SMA) line.</p>
        <canvas id="calculatedLinesChartCanvas" width="700" height="400"></canvas>
    </div>

    <div class="chart-container">
        <h2>Chart 9: Multi-Axis Chart (Temperature & Humidity)</h2>
        <p>Demonstrates two Y-axes. Temperature (Bar) is on the left Y-axis, and Humidity (Line) is on the right Y-axis.</p>
        <canvas id="multiAxisChartCanvas" width="700" height="400"></canvas>
    </div>

    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <h2>Autosize Demo (Responsive)</h2>
    <p>Resize the container (e.g., by resizing the browser window if the container has percentage width, or drag its corner if it's made resizable with CSS) to see the chart adapt.</p>
    <div id="autosizeContainer_full" style="width: 70%; height: 350px; border: 1px solid #ccc; padding: 10px; resize: both; overflow: auto; margin-bottom: 20px;">
        <canvas id="autosizeChartCanvas_full"></canvas>
    </div>

    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <h2>Autosize with Max Dimensions Demo</h2>
    <p>The container below is larger than the canvas's initial HTML attributes (width="400", height="250"). The chart will use the container size up to these maximums.</p>
    <div id="maxSizeContainer_full" style="width: 600px; height: 400px; border: 1px solid #ccc; padding: 10px; margin-bottom: 20px;">
        <canvas id="maxSizeChartCanvas_full" width="400" height="250"></canvas>
    </div>
    <p>Container below is smaller than canvas attributes. Chart will shrink.</p>
    <div id="maxSizeContainerSmall_full" style="width: 300px; height: 200px; border: 1px solid #ccc; padding: 10px; margin-bottom: 20px;">
        <canvas id="maxSizeChartCanvasSmall_full" width="400" height="250"></canvas>
    </div>

    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <h2>Fixed Size Chart Demo (Autosize Off)</h2>
    <p>This chart has <code>autosize: false</code> and fixed dimensions (450x280), regardless of container size.</p>
    <div id="fixedSizeContainer_full" style="width: 70%; height: 350px; border: 1px solid #ccc; padding: 10px; margin-bottom: 20px;">
        <canvas id="fixedSizeChartCanvas_full"></canvas>
    </div>

    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <div class="chart-container">
        <h2>Percentage Chart (Direct Values)</h2>
        <p>Demonstrates <code>percentageDistribution</code> type with <code>valuesArePercentages: true</code>. Input values are used directly as percentages.</p>
        <canvas id="directPercentageChartCanvas" width="700" height="250"></canvas>
    </div>

    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <div class="chart-container">
        <h2>Line Chart with Period Highlighting</h2>
        <p>Demonstrates a line chart with date-based X-axis and highlighted historical periods using the <code>periodHighlights</code> option.</p>
        <canvas id="periodHighlightChartCanvas" width="700" height="400"></canvas>
    </div>

    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <h2>Chart Destroy Demo</h2>
    <div id="destroyableContainer_full" style="width: 500px; height: 300px; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
        <canvas id="destroyableChartCanvas_full"></canvas>
    </div>
    <button id="createChartBtn_full">Create Chart</button>
    <button id="destroyChartBtn_full" disabled>Destroy Chart</button>

    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <h2>X-Axis Label Filtering</h2>
    <p>This chart has many labels. Observe how labels are skipped to prevent overlap. Try resizing the container.</p>
    <div id="labelFilterContainer_full" style="width: 90%; max-width:700px; height: 350px; border: 1px solid #ccc; padding: 10px; resize: both; overflow: auto; margin-bottom: 20px;">
        <canvas id="labelFilterChartCanvas_full"></canvas>
    </div>

    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <h2>Original Demo Charts (for reference)</h2>

    <div class="chart-container">
        <h2>Bar Chart (Original)</h2>
        <canvas id="barChartCanvasAutonome" width="700" height="350"></canvas>
    </div>

    <div class="chart-container">
        <h2>Line Chart (Original)</h2>
        <canvas id="lineChartCanvasAutonome" width="700" height="350"></canvas>
    </div>

    <div class="chart-container">
        <h2>Percentage Distribution (New "Gauge" Style - Original)</h2>
        <canvas id="percentageChartNewStyleAutonome" width="700" height="200"></canvas>
    </div>
    
    <div class="chart-container">
        <h2>Percentage Distribution (Classic Style - Original)</h2>
        <canvas id="percentageChartOldStyleAutonome" width="700" height="200"></canvas>
    </div>

    <script src="PureChart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Chart 5: Multi-Line Chart (Few-Items Legend Control)
            const multiLineChartConfig = {
                type: 'line',
                data: {
                    labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
                    datasets: [
                        {
                            label: "Page Views",
                            values: [150, 230, 224, 218, 135, 147, 260],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            tension: 0.1
                        },
                        {
                            label: "Unique Visitors",
                            values: [80, 100, 120, 100, 90, 100, 140],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    title: { display: true, text: "Few-Items Legend Control Chart" },
                    legend: { display: true, position: 'top' },
                    yAxis: { title: "Count" }
                }
            };
            new PureChart('multiLineChartCanvas', multiLineChartConfig);

            // Chart 6: Vertical Bar Chart (topCornerRadius: 8 Test)
            const verticalBarChartConfig = {
                type: 'bar',
                data: {
                    labels: ["Val A", "Val B", "Val C", "Val D", "Val E", "Val F"],
                    datasets: [
                        {
                            label: "Test Series with topCornerRadius: 8",
                            values: [10, 15, -5, 8, -12, 0],
                            backgroundColor: 'rgba(86, 160, 211, 0.7)', // #56A0D3 with alpha
                            borderColor: 'rgba(42, 78, 122, 1)'     // #2A4E7A
                        }
                    ]
                },
                options: {
                    title: { display: true, text: "Bar Chart (topCornerRadius: 8)" },
                    legend: { display: true, position: 'top' },
                    yAxis: { title: "Value", beginAtZero: true }, // beginAtZero for this test is fine, negative bars will extend downwards
                    bar: {
                        topCornerRadius: 8
                    }
                }
            };
            new PureChart('verticalBarChartCanvas', verticalBarChartConfig);

            // Chart 6b: Vertical Bar Chart (topCornerRadius: 0 Control)
            const verticalBarChartControlConfig = {
                type: 'bar',
                data: {
                    labels: ["Val A", "Val B", "Val C", "Val D", "Val E", "Val F"],
                    datasets: [
                        {
                            label: "Test Series with topCornerRadius: 0",
                            values: [10, 15, -5, 8, -12, 0],
                            backgroundColor: 'rgba(211, 86, 86, 0.7)', // Different color for visual distinction
                            borderColor: 'rgba(122, 42, 42, 1)'
                        }
                    ]
                },
                options: {
                    title: { display: true, text: "Bar Chart (topCornerRadius: 0 Control)" },
                    legend: { display: true, position: 'top' },
                    yAxis: { title: "Value", beginAtZero: true },
                    bar: {
                        topCornerRadius: 0
                    }
                }
            };
            new PureChart('verticalBarChartControlCanvas', verticalBarChartControlConfig);


            // Chart 7: Horizontal Bar Chart (Implemented as Vertical)
            // Note: PureChart does not currently support true horizontal bar charts. This is a vertical bar chart.
            const horizontalBarChartConfig = {
                type: 'bar',
                data: {
                    labels: ["Feature X", "Feature Y", "Feature Z"],
                    datasets: [
                        {
                            label: "Usage",
                            values: [65, 40, 80],
                            backgroundColor: 'rgba(153, 102, 255, 0.5)',
                            borderColor: 'rgba(153, 102, 255, 1)'
                        }
                    ]
                },
                options: {
                    title: { text: "Bar Chart (Simulating Horizontal)" },
                    yAxis: { title: "Frequency", beginAtZero: true }
                }
            };
            new PureChart('horizontalBarChartCanvas', horizontalBarChartConfig);

            // Chart 8: Chart with Calculated Lines (SMA)
            const calculatedLinesChartConfig = {
                type: 'line',
                data: {
                    labels: ["Day 1", "Day 2", "Day 3", "Day 4", "Day 5", "Day 6", "Day 7", "Day 8", "Day 9", "Day 10"],
                    datasets: [
                        {
                            label: "Raw Data",
                            values: [10, 12, 11, 13, 14, 16, 15, 17, 18, 20],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            fill: false
                        },
                        {
                            label: "SMA (3-Day)",
                            type: 'sma',
                            sourceDatasetIndex: 0,
                            period: 3,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            lineWidth: 2
                        }
                    ]
                },
                options: {
                    title: { text: "Data with 3-Day SMA" },
                    yAxis: { title: "Measurement" }
                }
            };
            new PureChart('calculatedLinesChartCanvas', calculatedLinesChartConfig);


            // Chart 9: Multi-Axis Chart
            const multiAxisChartConfig = {
                type: 'bar', // Default type, can be overridden by datasets
                data: {
                    labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul"],
                    datasets: [
                        {
                            label: "Temperature (째C)",
                            type: 'bar', // Explicitly bar
                            values: [10, 12, 15, 18, 22, 25, 23],
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            yAxisID: 'yAxis-temp' // Assign to the temperature axis
                        },
                        {
                            label: "Humidity (%)",
                            type: 'line', // Explicitly line
                            values: [60, 65, 70, 75, 72, 68, 70],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            fill: true,
                            tension: 0.1,
                            yAxisID: 'yAxis-humidity' // Assign to the humidity axis
                        }
                    ]
                },
                options: {
                    theme: 'light', // Or 'dark', as preferred for demo
                    title: { 
                        display: true,
                        text: "Monthly Average Temperature and Humidity" 
                    },
                    legend: { 
                        display: true, 
                        position: 'top' 
                    },
                    yAxes: [ // Define the two Y-axes
                        {
                            id: 'yAxis-temp',
                            position: 'left',
                            display: true,
                            title: 'Temperature (째C)',
                            displayTitle: true,
                            beginAtZero: false, // Temperature can go below zero
                            gridLines: true, // Primary grid lines from this axis
                            sampleLabelForWidthEstimation: "-10.0" 
                        },
                        {
                            id: 'yAxis-humidity',
                            position: 'right',
                            display: true,
                            title: 'Humidity (%)',
                            displayTitle: true,
                            beginAtZero: true, // Humidity typically 0-100
                            gridLines: false, // No duplicate grid lines from this axis
                            maxTicks: 6, // Example of different tick count
                            sampleLabelForWidthEstimation: "100.0%" 
                        }
                    ],
                    xAxis: {
                        display: true,
                        title: 'Month',
                        displayTitle: true
                    },
                    tooltip: {
                        formatter: function(params) { // Use a regular function to access bound `this`
                            if (!params) return '';
                            let html = `<div style="font-weight:bold;margin-bottom:5px;text-align:left;">${params.xLabel || ''}</div>`;
                            
                            (params.datasets || []).forEach((item) => {
                                if (item && item.dataset) {
                                    const datasetYAxisID = item.dataset.yAxisID;
                                    let axisLabel = ` (${datasetYAxisID})`; // Default to ID
                                    
                                    if (params.yAxisScaleInfo && params.yAxisScaleInfo.axisConfig && params.yAxisScaleInfo.axisConfig.id === datasetYAxisID) {
                                        axisLabel = ` (${params.yAxisScaleInfo.axisConfig.title || datasetYAxisID})`;
                                    } else if (this.chartYAxesConfig) { 
                                        const axisConf = this.chartYAxesConfig.find(ax => ax.id === datasetYAxisID);
                                        if (axisConf && axisConf.title) {
                                            axisLabel = ` (${axisConf.title})`;
                                        }
                                    }

                                    let markerColor = item.dataset.borderColor || (Array.isArray(item.dataset.backgroundColor) ? item.dataset.backgroundColor[0] : item.dataset.backgroundColor);
                                    if (!markerColor) {
                                        const palette = params.themePalette || PC_LIGHT_THEME_PALETTE; 
                                        const originalDatasetIndex = this.chartConfigData.datasets.findIndex(ds => ds.label === item.dataset.label);
                                        if (originalDatasetIndex !== -1) {
                                            markerColor = palette.defaultDatasetColors[originalDatasetIndex % palette.defaultDatasetColors.length];
                                        } else {
                                            markerColor = '#ccc'; 
                                        }
                                    }
                                    html += `<div style="text-align:left;"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background-color:${markerColor};margin-right:5px;"></span>${item.dataset.label || 'Dataset'}: ${item.value !== undefined ? item.value.toLocaleString() : 'N/A'}${axisLabel}</div>`;
                                }
                            });
                            return html;
                        }
                    }
                }
            };
            const formatterContext = { 
                chartConfigData: multiAxisChartConfig.data, 
                chartYAxesConfig: multiAxisChartConfig.options.yAxes 
            };
            multiAxisChartConfig.options.tooltip.formatter = multiAxisChartConfig.options.tooltip.formatter.bind(formatterContext);
            
            new PureChart('multiAxisChartCanvas', multiAxisChartConfig);
            
            const advancedMixedConfig = {
                type: 'bar', 
                data: {
                    labels: ["Q1", "Q2", "Q3", "Q4"],
                    datasets: [
                        {
                            label: 'Product A Sales',
                            type: 'bar',
                            values: [120, 150, 180, 130],
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1,
                            averageLine: {
                                display: true,
                                color: 'rgba(200, 0, 0, 0.8)', 
                                lineWidth: 2,
                                dashPattern: [4, 4],
                                label: {
                                    display: true,
                                    color: 'rgb(150,0,0)',
                                    font: 'bold 10px Arial',
                                    position: 'above-center', 
                                    backgroundColor: 'rgba(255, 255, 255, 0.7)',
                                    formatter: (avg) => `Avg Sales A: ${avg.toFixed(1)}`
                                }
                            }
                        },
                        {
                            label: 'Product B Sales',
                            type: 'bar',
                            values: [80, 100, 90, 110],
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Market Trend',
                            type: 'line',
                            values: [95, 120, 130, 115],
                            borderColor: 'rgba(75, 192, 192, 1)',
                            fill: false,
                            tension: 0.1,
                            pointRadius: 4
                        },
                        {
                            label: 'Forecast',
                            type: 'line',
                            values: [110, 130, 140, 120],
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderDash: [10, 5], 
                            fill: false,
                            pointRadius: 2,
                            pointStyle: 'square'
                        }
                    ]
                },
                options: {
                    theme: 'dark', 
                    title: { text: "Quarterly Product Performance (Dark Theme)" },
                    legend: { display: true, position: 'top' },
                    yAxis: { title: "Units Sold" },
                    annotations: [{
                        type: 'line',
                        mode: 'horizontal',
                        value: 140,
                        borderColor: 'rgba(0,0,0,0.7)',
                        borderWidth: 1,
                        label: { text: 'Sales Target: 140', position: 'top-right', color: 'black', font: '10px Arial' }
                    }]
                }
            };
            new PureChart('advancedMixedChartCanvas', advancedMixedConfig);

            const multipleSmaAnnotationConfig = {
                type: 'line',
                data: {
                    labels: Array.from({length: 20}, (_, i) => `Day ${i+1}`),
                    datasets: [
                        {
                            label: 'Stock X Price',
                            type: 'line',
                            values: [50, 52, 51, 53, 55, 54, 57, 58, 56, 60, 62, 61, 63, 65, 64, 67, 68, 66, 70, 72],
                            borderColor: 'rgba(0, 100, 255, 1)',
                            backgroundColor: 'rgba(0, 100, 255, 0.1)',
                            fill: true,
                            pointRadius: 2
                        },
                        {
                            label: 'SMA (5 Days)',
                            type: 'sma',
                            sourceDatasetIndex: 0,
                            period: 5,
                            borderColor: 'rgba(255, 159, 64, 1)',
                            lineWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: 'SMA (10 Days)',
                            type: 'sma',
                            sourceDatasetIndex: 0,
                            period: 10,
                            borderColor: 'rgba(150, 75, 0, 1)',
                            lineWidth: 2,
                            borderDash: [3,3],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    theme: 'light', 
                    title: { text: "Stock X Price with SMAs and Price Levels (Light Theme)" },
                    legend: { display: true },
                    yAxis: { title: "Price ($)" },
                    annotations: [
                        {
                            type: 'line',
                            mode: 'horizontal',
                            value: 65,
                            borderColor: 'green',
                            borderWidth: 2,
                            label: { 
                                text: 'Support Level: $65', 
                                position: 'left', 
                                color: 'green',
                                font: '12px Arial bold',
                                backgroundColor: 'rgba(220,255,220,0.8)',
                                padding: 5
                            }
                        },
                        {
                            type: 'line',
                            mode: 'horizontal',
                            percentage: 75, 
                            borderColor: 'purple',
                            borderDash: [4,4],
                            label: { 
                                text: '75th Percentile', 
                                position: 'bottom-right', 
                                color: 'purple',
                                padding: {x:4, y:2}
                            }
                        },
                         {
                            type: 'line',
                            mode: 'horizontal',
                            value: 52,
                            borderColor: '#AAA',
                            borderWidth: 1,
                            label: { 
                                text: 'Previous Low', 
                                position: 'center', 
                                color: '#555',
                                font: '10px Arial',
                                backgroundColor: 'rgba(230,230,230,0.5)'
                            }
                        }
                    ]
                }
            };
            new PureChart('multipleSmaAnnotationCanvas', multipleSmaAnnotationConfig);

            try {
                const response = await fetch('sample-data.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const jsonData = await response.json();
                
                if (jsonData.mixedChartWithSmaAndAnnotation) {
                    const overrideOptions = {
                        options: {
                            theme: 'dark',
                            title: { text: jsonData.mixedChartWithSmaAndAnnotation.options.title.text + " (Dark Theme Override)" }
                        }
                    };
                    const chartConfigFromJson = PureChart._mergeDeep(jsonData.mixedChartWithSmaAndAnnotation, overrideOptions);
                    new PureChart('jsonLoadedChartCanvas', chartConfigFromJson);
                } else {
                    console.error("Chart configuration 'mixedChartWithSmaAndAnnotation' not found in sample-data.json");
                    document.getElementById('jsonLoadedChartCanvas').outerHTML = "<p>Error: Chart configuration not found in sample-data.json.</p>";
                }
            } catch (e) {
                console.error("Error loading chart from JSON for demo_full.html (Chart 3):", e);
                document.getElementById('jsonLoadedChartCanvas').outerHTML = `<p style="color:red;">Could not load chart from JSON (Chart 3): ${e.message}</p>`;
            }

            PureChart.fromJSON('fromJsonDemoCanvas', 'single_chart_example.json', {}, null )
                .then(chart => {
                    if (chart && chart.isValid) {
                        console.log("Chart 'fromJsonDemoCanvas' loaded successfully via PureChart.fromJSON().");
                    } else {
                        console.error("Failed to load or chart is invalid from 'single_chart_example.json' via PureChart.fromJSON().");
                        const canvas = document.getElementById('fromJsonDemoCanvas');
                        if (canvas && canvas.getContext) { 
                            const ctx = canvas.getContext('2d');
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            ctx.font = '12px Arial'; ctx.fillStyle = 'orange'; ctx.textAlign = 'center';
                            ctx.fillText('Chart loaded but invalid.', canvas.width / 2, canvas.height / 2);
                        }
                    }
                })
                .catch(error => {
                    console.error("Error loading chart 'fromJsonDemoCanvas' via PureChart.fromJSON():", error);
                    const canvas = document.getElementById('fromJsonDemoCanvas');
                    if (canvas && canvas.getContext) { 
                        const ctx = canvas.getContext('2d');
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.font = '12px Arial'; ctx.fillStyle = 'red'; ctx.textAlign = 'center';
                        ctx.fillText(`Error fromJSON: ${String(error.message).substring(0,100)}`, canvas.width / 2, canvas.height / 2);
                    }
                });
            
            const barChartConfigOriginal = {
                type: "bar",
                data: {
                    labels: ["Apples", "Oranges", "Bananas", "Pears", "Grapes"], 
                    datasets: [{
                        label: "Fruit Store Alpha Stock", 
                        values: [30, 45, 22, 35, 50],
                        backgroundColor: "rgba(75, 192, 192, 0.7)",
                    }, {
                        label: "Fruit Store Beta Stock", 
                        values: [25, 30, 40, 20, 45],
                        backgroundColor: "rgba(255, 159, 64, 0.7)",
                        borderColor: "darkorange", 
                        borderWidth: 1
                    }]
                },
                options: {
                    title: { text: "Fruit Stock (Standalone)" }, 
                    yAxis: { beginAtZero: true, title: "Quantity in Kg" }, 
                    bar: { defaultBorderWidth: 2, borderDarkenPercent: 25 }
                }
            };
            new PureChart('barChartCanvasAutonome', barChartConfigOriginal);

            const lineChartConfigOriginal = {
                type: "line",
                data: {
                    labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"], 
                    datasets: [{
                        label: "Average Temperature (째C)", 
                        values: [5, 7, 12, 18, 22, 25],
                        borderColor: "rgb(255, 99, 132)",
                        backgroundColor: "rgba(255, 99, 132, 0.15)",
                        tension: 0.3,
                        fill: true,
                        pointRadius: 5,
                        pointStyle: 'circle',
                        pointColor: "rgb(255, 99, 132)",
                        pointBorderColor: "#fff",
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    title: { text: "Average Temperatures (Standalone)" }, 
                    yAxis: { title: "째C" },
                    xAxis: { title: "Month", gridLines: true } 
                }
            };
            new PureChart('lineChartCanvasAutonome', lineChartConfigOriginal);
            
            const percentageChartNewStyleConfig = {
                type: "percentageDistribution",
                data: {
                    items: [
                        { "label": "Product Satisfaction", "value": 92 }, 
                        { "label": "Customer Service Quality", "value": 85 }, 
                        { "label": "Processing Speed", "value": 70 } 
                    ]
                },
                options: {
                    title: { text: "Key Performance Indicators (New Style)" }, 
                    percentageDistribution: {
                        colors: ["#56ab2f", "#a8e063", "#2193b0"], 
                        borderWidth: 3,
                        fillLightenPercent: 70, 
                        barHeight: 30,
                        barBorderRadius: { tl: 6, tr: 6, br: 6, bl: 6 },
                        labelPosition: 'left',
                        maxLabelWidth: 220,
                        valuePosition: 'insideEnd',
                        valueFont: "12px Arial Black",
                        valueColor: (params) => (params.item.percentage > 50 ? '#111' : '#f0f0f0'), 
                        sort: 'ascending'
                    }
                }
            };
            new PureChart('percentageChartNewStyleAutonome', percentageChartNewStyleConfig);

            const percentageChartOldStyleConfig = {
                type: "percentageDistribution",
                data: {
                    items: [
                        { "label": "Market Share A", "value": 45 }, 
                        { "label": "Market Share B", "value": 35 }, 
                        { "label": "Market Share C (Others)", "value": 20 } 
                    ]
                },
                options: {
                    title: { text: "Market Shares (Classic Style)" }, 
                    percentageDistribution: {
                        colors: ["#1abc9c", "#3498db", "#9b59b6"],
                        borderWidth: 1,
                        borderDarkenPercent: 30,
                        barHeight: 25,
                        barBorderRadius: 2,
                        valuePosition: 'right'
                    }
                }
            };
            new PureChart('percentageChartOldStyleAutonome', percentageChartOldStyleConfig);

            // --- Appended Demos Start ---

            // Autosize Demo Chart (for demo_full.html)
            const autosizeCtx_full = document.getElementById('autosizeChartCanvas_full');
            if (autosizeCtx_full) {
                new PureChart(autosizeCtx_full.id, {
                    type: 'line',
                    data: {
                        labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
                        datasets: [{
                            label: 'Monthly Sales',
                            values: [65, 59, 80, 81, 56, 55, 40],
                            borderColor: '#007bff',
                            tension: 0.1
                        }]
                    },
                    options: {
                        title: { text: 'Responsive Chart (Autosize On)' }
                    }
                });
            }

            // Autosize with Max Dimensions Demo (Larger Container - for demo_full.html)
            const maxSizeCtx_full = document.getElementById('maxSizeChartCanvas_full');
            if (maxSizeCtx_full) {
                new PureChart(maxSizeCtx_full.id, {
                    type: 'bar',
                    data: {
                        labels: ['A', 'B', 'C', 'D', 'E'],
                        datasets: [{
                            label: 'Performance',
                            values: [12, 19, 3, 5, 2],
                            backgroundColor: '#28a745'
                        }]
                    },
                    options: {
                        title: { text: 'Autosize with Max (Canvas: 400x250)' }
                    }
                });
            }

            // Autosize with Max Dimensions Demo (Smaller Container - for demo_full.html)
            const maxSizeCtxSmall_full = document.getElementById('maxSizeChartCanvasSmall_full');
            if (maxSizeCtxSmall_full) {
                new PureChart(maxSizeCtxSmall_full.id, {
                    type: 'bar',
                    data: {
                        labels: ['A', 'B', 'C', 'D', 'E'],
                        datasets: [{
                            label: 'Performance',
                            values: [12, 19, 3, 5, 2],
                            backgroundColor: '#ffc107'
                        }]
                    },
                    options: {
                        title: { text: 'Autosize with Max (Canvas: 400x250, Container Smaller)' }
                    }
                });
            }

            // Fixed Size Chart Demo (for demo_full.html)
            const fixedSizeCtx_full = document.getElementById('fixedSizeChartCanvas_full');
            if (fixedSizeCtx_full) {
                new PureChart(fixedSizeCtx_full.id, {
                    type: 'bar', // Changed from pie for safety
                    width: 450,
                    height: 280,
                    data: {
                        labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple'],
                        datasets: [{
                            label: 'Votes',
                            values: [300, 50, 100, 40, 120],
                            backgroundColor: ['#dc3545', '#007bff', '#ffc107', '#28a745', '#6f42c1']
                        }]
                    },
                    options: {
                        autosize: false,
                        title: { text: 'Fixed Size Chart (450x280)' }
                    }
                });
            }

            // Destroy Method Demo (for demo_full.html)
            const createChartBtn_full = document.getElementById('createChartBtn_full');
            const destroyChartBtn_full = document.getElementById('destroyChartBtn_full');
            const destroyableCanvasId_full = 'destroyableChartCanvas_full';
            let destroyableChart_full = null;

            function createDestroyableChart_full() {
                if (destroyableChart_full) {
                    destroyableChart_full.destroy();
                }
                const canvasEl_full = document.getElementById(destroyableCanvasId_full);
                if (canvasEl_full) {
                    const ctx_full = canvasEl_full.getContext('2d');
                    ctx_full.clearRect(0,0,canvasEl_full.width, canvasEl_full.height);

                    destroyableChart_full = new PureChart(destroyableCanvasId_full, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                            datasets: [{ label: 'Activity', values: [5,9,6,8,7], tension: 0 }]
                        },
                        options: { title: { text: 'Destroyable Chart' }}
                    });
                    if(createChartBtn_full) createChartBtn_full.disabled = true;
                    if(destroyChartBtn_full) destroyChartBtn_full.disabled = false;
                    console.log('Chart created for destroy demo (full).');
                }
            }

            function destroyTheChart_full() {
                if (destroyableChart_full) {
                    destroyableChart_full.destroy();
                    destroyableChart_full = null;
                    if(createChartBtn_full) createChartBtn_full.disabled = false;
                    if(destroyChartBtn_full) destroyChartBtn_full.disabled = true;
                    console.log('Chart destroyed (full).');
                    const canvasEl_full = document.getElementById(destroyableCanvasId_full);
                    if(canvasEl_full) {
                        const ctx_full = canvasEl_full.getContext('2d');
                        if (ctx_full) { // Ensure context is available
                           ctx_full.clearRect(0,0,canvasEl_full.width, canvasEl_full.height);
                           ctx_full.font = "16px Arial";
                           ctx_full.textAlign = "center";
                           ctx_full.fillText("Chart destroyed. Create again.", canvasEl_full.width/2, canvasEl_full.height/2);
                        }
                    }
                }
            }

            if (createChartBtn_full) createChartBtn_full.addEventListener('click', createDestroyableChart_full);
            if (destroyChartBtn_full) destroyChartBtn_full.addEventListener('click', destroyTheChart_full);
            createDestroyableChart_full(); // Initial creation

            // X-Axis Label Filtering (for demo_full.html)
            const labelFilterCtx_full = document.getElementById('labelFilterChartCanvas_full');
            if (labelFilterCtx_full) {
                const manyLabels_full = [];
                for (let i = 1; i <= 50; i++) {
                    manyLabels_full.push(`Label ${i}`);
                }
                const manyValues_full = manyLabels_full.map(() => Math.random() * 100);

                new PureChart(labelFilterCtx_full.id, {
                    type: 'line',
                    data: {
                        labels: manyLabels_full,
                        datasets: [{
                            label: 'Data Series',
                            values: manyValues_full,
                            borderColor: '#6f42c1',
                            tension: 0.2
                        }]
                    },
                    options: {
                        title: { text: 'X-Axis Label Filtering Demo' }
                    }
                });
            }
            // --- Appended Demos End ---

            // Percentage Chart (Direct Values) Demo
            const directPercentageChartConfig = {
                type: "percentageDistribution",
                data: {
                    items: [
                        { "label": "Task A Progress", "value": 80 },
                        { "label": "Task B Progress", "value": 55.7 },
                        { "label": "Task C Blocked", "value": 10.3 },
                        { "label": "Task D Critical", "value": 50 },
                        { "label": "Task E Negative", "value": 10 }
                    ]
                },
                options: {
                    title: { text: "Project Status (Direct Percentages)" },
                    percentageDistribution: {
                        valuesArePercentages: true, // Key option for this demo
                        colors: ["#4CAF50", "#FFC107", "#F44336", "#795548", "#00BCD4"], // Example colors
                        barHeight: 25,
                        barBorderRadius: 5,
                        labelPosition: 'left',
                        maxLabelWidth: 180,
                        valuePosition: 'insideEnd',
                        valueFont: "12px Arial Black"
                    }
                }
            };
            new PureChart('directPercentageChartCanvas', directPercentageChartConfig);

            // Line Chart with Period Highlighting Demo
            const periodHighlightChartConfig = {
                type: 'line',
                data: {
                    labels: [
                        "2023-01-01", "2023-01-15", "2023-02-01", "2023-02-15", 
                        "2023-03-01", "2023-03-15", "2023-04-01", "2023-04-15",
                        "2023-05-01", "2023-05-15", "2023-06-01", "2023-06-15",
                        "2023-07-01", "2023-07-15", "2023-08-01"
                    ],
                    datasets: [{
                        label: "Stock XYZ",
                        values: [100, 102, 105, 103, 107, 110, 115, 112, 108, 105, 100, 98, 101, 103, 105],
                        borderColor: 'rgba(0,123,255,1)', // Bootstrap Primary Blue
                        backgroundColor: 'rgba(0,123,255,0.1)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    title: { text: "Stock Prices with Highlighted Economic Periods" },
                    xAxis: { title: 'Date' },
                    yAxis: { title: 'Price', beginAtZero: false },
                    periodHighlights: {
                        display: false,
                        legendLabel: "Economic Events",
                        periods: [
                            {
                                name: "Q1 Rally",
                                startDate: "2023-01-15",
                                endDate: "2023-03-30"
                                // Uses defaultStyle from PureChart.js
                            },
                            {
                                name: "Correction",
                                startDate: "2023-04-01",
                                endDate: "2023-05-31",
                                style: {
                                    fillColor: 'rgba(255, 193, 7, 0.15)', // Light warning yellow
                                    borderColor: 'rgba(255, 193, 7, 0.4)',
                                    label: {
                                        color: '#721c24', // Dark red for contrast
                                        angle: 0, 
                                        position: 'center',
                                        font: 'bold 10px Arial'
                                    }
                                }
                            },
                            {
                                name: "Recovery Speculation",
                                startDate: "2023-06-10",
                                endDate: "2023-07-10",
                                style: {
                                    fillColor: 'rgba(40, 167, 69, 0.1)', // Light success green
                                    borderColor: 'rgba(40, 167, 69, 0.3)',
                                    label: {
                                        color: '#155724', // Dark green
                                        angle: -25,
                                        position: 'above',
                                        offset: 8,
                                        font: 'italic 9px Verdana'
                                    }
                                }
                            }
                        ]
                    }
                }
            };
            new PureChart('periodHighlightChartCanvas', periodHighlightChartConfig);
        });
    </script>
</body>
</html>
